@{
    ViewData["Title"] = "TempBasket";
}

<!-- الجدول الذي يعرض تفاصيل السلة -->
<table id="basket-details">
    <thead>
        <tr>
            <th>رقم السلة</th>
            <th>رقم الحساب</th>
            <th>الخصم</th>
            <th>اجمالي المبلغ</th>
            <th>ملاحظة</th>
            <th>تاريخ الانشاء</th>
            <th>تاريخ التعديل</th>
            <th>رقم الحواله الماليه</th>
            <th>حاله الحفظ</th>
            <th>التحقق من الدفع</th>
            <th>تأكيد الدفع</th>
        </tr>
    </thead>
    <tbody>
        <!-- سيتم إضافة الصفوف هنا بشكل ديناميكي -->
    </tbody>
</table>
<br />
<!-- الجدول الذي يعرض تفاصيل عمليات البيع -->
<table id="sales-details">
    <thead>
        <tr>
            <th>رقم البيع</th>
            <th>رقم المنتج</th>
            <th>رقم اللون</th>
            <th>رقم الحجم</th>
            <th>الكمية</th>
            <th>السعر</th>
            <th>رقم السلة</th>
            <th>تعديل الكمية</th>
            <th>حذف البيع</th>
        </tr>
    </thead>
    <tbody>
        <!-- سيتم إضافة الصفوف هنا بشكل ديناميكي -->
    </tbody>
</table>


<!-- النافذة المنبثقة لإدخال MoneyTransformNum -->
<div id="payment-popup" style="display: none;">
    <input type="text" id="money-transform-num" placeholder="أدخل رقم التحويل المالي هنا" />
    <button>تأكيد الدفع</button>
</div>

<script>
    $(document).ready(function () {
        // استبدل هذا بمعرف السلة الخاص بك
        var basketId = '@ViewBag.BasketId';
        // جلب تفاصيل السلة
        $.ajax({
            url: "/api/Baskets/" + 2,
            type: "GET",
            success: function (basket) {
                // إضافة صف جديد إلى جدول تفاصيل السلة
                $("#basket-details").append(
                    "<tr>" +
                    "<td>" + basket.BasketId + "</td>" +
                    "<td>" + basket.AccountId + "</td>" +
                    "<td>" + basket.Discount + "</td>" +
                    "<td>" + basket.Total + "</td>" +
                    "<td>" + basket.Note + "</td>" +
                    "<td>" + basket.CreatedAt + "</td>" +
                    "<td>" + basket.UpdatedAt + "</td>" +
                    "<td>" + basket.MoneyTransformNum + "</td>" +
                    "<td>" + basket.SaveStatus + "</td>" +
                    "<td>" + basket.PaymentVerification + "</td>" +
                    "<td><button class='confirm-payment'>تأكيد الدفع</button></td>" +
                    "</tr>"
                );
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.error("An error occurred: ", textStatus, ", ", errorThrown);
                alert("حدث خطأ أثناء جلب تفاصيل السلة. يرجى التحقق من الخادم والاتصال بالإنترنت.");
            }
        });

        // جلب تفاصيل عمليات البيع للسلة
        $.ajax({
            url: "/api/Baskets/" + 2 + "/Sales",
            type: "GET",
            success: function (sales) {
                sales.forEach(function (sale) {
                    // إضافة صف جديد إلى جدول تفاصيل عمليات البيع
                    $("#sales-details").append(
                        "<tr>" +
                        "<td>" + sale.SaleId + "</td>" +
                        "<td>" + sale.ProductId + "</td>" +
                        "<td>" + sale.ColorId + "</td>" +
                        "<td>" + sale.SizeId + "</td>" +
                        "<td><input type='text' value='" + sale.Quantity + "' /></td>" +
                        "<td>" + sale.Price + "</td>" +
                        "<td>" + sale.BasketId + "</td>" +
                        "<td><button class='update-quantity'>تعديل الكمية</button></td>" +
                        "<td><button class='delete-sale'>حذف البيع</button></td>" +
                        "</tr>"
                    );
                });
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.error("An error occurred: ", textStatus, ", ", errorThrown);
                alert("حدث خطأ أثناء جلب تفاصيل عمليات البيع. يرجى التحقق من الخادم والاتصال بالإنترنت.");
            }
        });
    });
</script>